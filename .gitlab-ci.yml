before_script:
  - curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py
  - python3 get-pip.py

stages:
  - black
  - eslint
  - staging

black:
  stage: black
  allow_failure: false
  script:
    - pip3 install black
    - black --check ./server
  only:
    - merge_requests

eslint:
  stage: eslint
  image: node:latest
  allow_failure: false
  script:
    - cd front
    - yarn add node-sass
    - yarn add eslint --dev
    - yarn add eslint-config-react-app -D \
      eslint-plugin-prettier
    - yarn run eslint . --max-warnings=0
  only:
    - merge_requests

merge_into_staging:
  stage: staging
  script:
    - pip3 install GitPython
    - pip3 install --upgrade python-gitlab
    - python3 ./devops/staging.py
  only:
    - merge_requests
    - dev
